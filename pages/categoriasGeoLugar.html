<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geografando</title>
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/logo.png" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap"
    />
    <link rel="stylesheet" href="../styles/styles.css" />
  </head>
  <body>
    <header>
      <div class="header-content">
        <a href="../index.html">
          <div class="logo-container">
            <img
              src="../assets/logo.png"
              alt="Imagem ao lado do logo"
              class="logo-image"
            />
            <h1>Geografando</h1>
          </div>
        </a>
        <div class="search-wrapper">
          <div class="input-group">
            <span class="input-group-text bg-transparent border-end-0">
              <i class="fas fa-search text-white"></i>
            </span>
            <input
              type="text"
              id="searchInput"
              class="form-control bg-transparent border-start-0 ps-0 text-white"
              placeholder="Pesquisar conteúdo..."
              aria-label="Pesquisar conteúdo"
            />
            <span
              class="input-group-text bg-transparent border-start-0 d-none"
              id="clearSearch"
            >
              <i class="fas fa-times text-white" style="cursor: pointer"></i>
            </span>
          </div>
          <div id="searchFeedback" class="mt-2 text-center d-none">
            <small class="text-white">Nenhum resultado encontrado</small>
          </div>
        </div>
        <div class="user-info">
          <nav>
            <a href="admin_pages/index.html" class="btn">Área Administrativa</a>
          </nav>
        </div>
        <div class="hamburger-menu">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      <div class="overlay-menu">
        <nav>
          <a href="#">Home</a>
          <a href="categoriasGeo.html">Categorias</a>
          <a href="#">Logout</a>
        </nav>
      </div>
    </header>

    <main>
      <a href="categoriasGeo.html" class="back-link"
        >← Voltar para Categorias</a
      >
      <div id="lugares-container">
        <!-- O conteúdo será carregado dinamicamente aqui -->
      </div>
    </main>

    <footer>
      <p>&copy; 2025 Geografando</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Search functionality -->
    <script src="../scripts/search.js"></script>
    <!-- Other scripts -->
    <script src="../scripts/scripts.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        loadLugares();
      });

      async function loadLugares() {
        try {
          const response = await fetch("http://127.0.0.1:8000/categorias");
          const categorias = await response.json();

          // Filtrar apenas as categorias do tipo LUGAR
          const lugares = categorias.filter((cat) => cat.tipo === "LUGAR");

          const container = document.getElementById("lugares-container");

          for (const lugar of lugares) {
            // Buscar detalhes específicos da categoria
            const detalhesResponse = await fetch(
              `http://127.0.0.1:8000/categorias/${lugar.id}`
            );
            const detalhes = await detalhesResponse.json();

            const section = document.createElement("div");
            section.className = "categoria-section";

            section.innerHTML = `
              <h1>${detalhes.titulo}</h1>
              <h2>${detalhes.descricao}</h2>
              
              <div class="tab-container">
                ${
                  detalhes.texto
                    ? '<button class="tab-link active" onclick="openTab(event, `Textos${lugar.id}`)">Textos</button>'
                    : ""
                }
                ${
                  detalhes.pdf_url
                    ? '<button class="tab-link" onclick="openTab(event, `PDFs${lugar.id}`)">PDFs</button>'
                    : ""
                }
                ${
                  detalhes.slides_url
                    ? '<button class="tab-link" onclick="openTab(event, `Slides${lugar.id}`)">Apresentações de Slides</button>'
                    : ""
                }
                ${
                  detalhes.video_url
                    ? '<button class="tab-link" onclick="openTab(event, `Videos${lugar.id}`)">Vídeos</button>'
                    : ""
                }
                ${
                  detalhes.foto_url
                    ? '<button class="tab-link" onclick="openTab(event, `Fotos${lugar.id}`)">Fotos</button>'
                    : ""
                }
              </div>

              ${
                detalhes.texto
                  ? `
                <section id="Textos${lugar.id}" class="tab-content active">
                  <h3>Textos</h3>
                  <article>
                    ${detalhes.texto}
                  </article>
                </section>
              `
                  : ""
              }

              ${
                detalhes.pdf_url
                  ? `
                <section id="PDFs${lugar.id}" class="tab-content">
                  <h3>PDFs</h3>
                  <ul>
                    <li>
                      <a href="http://127.0.0.1:8000${detalhes.pdf_url}" class="download-link" target="_blank">
                        Visualizar PDF
                      </a>
                    </li>
                  </ul>
                </section>
              `
                  : ""
              }

              ${
                detalhes.slides_url
                  ? `
                <section id="Slides${lugar.id}" class="tab-content">
                  <h3>Apresentações de Slides</h3>
                  <ul>
                    <li>
                      <a href="http://127.0.0.1:8000${detalhes.slides_url}" class="download-link" target="_blank">
                        Baixar Apresentação
                      </a>
                    </li>
                  </ul>
                </section>
              `
                  : ""
              }

              ${
                detalhes.video_url
                  ? `
                <section id="Videos${lugar.id}" class="tab-content">
                  <h3>Vídeos</h3>
                  <div class="video-container">
                    <video controls>
                      <source src="http://127.0.0.1:8000${detalhes.video_url}" type="video/mp4">
                      Seu navegador não suporta o elemento de vídeo.
                    </video>
                  </div>
                </section>
              `
                  : ""
              }

              ${
                detalhes.foto_url
                  ? `
                <section id="Fotos${lugar.id}" class="tab-content">
                  <h3>Fotos</h3>
                  <div class="photo-gallery">
                    <img src="http://127.0.0.1:8000${detalhes.foto_url}" alt="Foto relacionada a ${detalhes.titulo}" />
                  </div>
                </section>
              `
                  : ""
              }
            `;

            container.appendChild(section);
          }
        } catch (error) {
          console.error("Erro ao carregar lugares:", error);
        }
      }

      function openTab(event, tabId) {
        const tabContents = event.target
          .closest(".categoria-section")
          .getElementsByClassName("tab-content");
        const tabLinks = event.target
          .closest(".categoria-section")
          .getElementsByClassName("tab-link");

        for (let content of tabContents) {
          content.classList.remove("active");
        }

        for (let link of tabLinks) {
          link.classList.remove("active");
        }

        document.getElementById(tabId).classList.add("active");
        event.target.classList.add("active");
      }
    </script>
  </body>
</html>
